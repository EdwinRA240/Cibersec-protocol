<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBERSEC PROTOCOL: REACQUISITION</title>
    
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'terminal-black': '#050505',
                        'neon-green': '#00ff00',
                        'neon-blue': '#00ffff',
                        'neon-purple': '#ff00ff',
                        'neon-yellow': '#ffff00',
                        'glitch-red': '#ff004c',
                        'glitch-cyan': '#00aaff',
                    },
                    fontFamily: {
                        mono: ['VT323', 'ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', 'monospace'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Base Styles */
        body {
            font-family: 'VT323', monospace;
            min-height: 100vh;
            background-color: #050505;
            color: #00ff00; 
            text-shadow: 0 0 2px rgba(0, 255, 0, 0.5);
            overflow-y: auto;
            /* Aumentamos el tamaño base de la letra para móviles */
            font-size: 1.25rem; /* Ajustado a un tamaño más grande */
            /* Subtle Background Noise/Scanline Effect */
            background-image: linear-gradient(rgba(0, 255, 0, 0.05) 1px, transparent 1px), 
                              linear-gradient(90deg, rgba(0, 255, 0, 0.03) 1px, transparent 1px);
            background-size: 100% 4px, 4px 100%;
        }
        /* Ajustes para pantallas más grandes, para evitar que sea *demasiado* grande */
        @media (min-width: 768px) { /* md breakpoint (tablets y desktop) */
            body {
                font-size: 1.15rem; /* Ligeramente más pequeño en pantallas grandes */
            }
        }

        .terminal-window {
            background-color: rgba(0, 0, 0, 0.9);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
            border: 1px solid #00ff00;
        }
        input, button {
            border: 1px solid #00ff00;
            background-color: #050505;
            color: #00ff00;
            text-shadow: none;
            transition: all 0.2s ease-in-out;
        }
        input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.6);
            border-color: #00ffff;
        }
        .submit-btn {
            background-color: #00ff00;
            color: #000000;
            font-weight: bold;
            text-shadow: none;
        }
        .submit-btn:hover {
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.8);
            background-color: #00cc00;
        }

        /* Glitch Animation for Start Screen */
        @keyframes glitch {
            0% { text-shadow: 2px 0 #ff004c, -2px 0 #00aaff; transform: translate(0); }
            15% { text-shadow: 2px 0 #ff004c, -2px 0 #00aaff; transform: translate(1px, -1px); }
            17% { text-shadow: none; transform: translate(-1px, 1px); }
            20% { text-shadow: 2px 0 #ff004c, -2px 0 #00aaff; transform: translate(1px, 0); }
            22% { text-shadow: 2px 0 #ff004c, -2px 0 #00aaff; transform: translate(0); }
            100% { text-shadow: none; }
        }
        .glitch-title {
            animation: glitch 4s infinite;
        }

        /* Cursors and other animations */
        @keyframes quickBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .quick-blink {
            animation: quickBlink 0.5s step-end infinite;
            color: #ffff00;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in {
            animation: fadeIn 1s ease-out forwards;
        }
        
        .disabled-phase {
            pointer-events: none;
            filter: grayscale(80%) brightness(50%);
            transition: all 0.5s;
        }
        
        /* Revised Subtle Protocol List Style (for mobile visibility) */
        .subtle-protocol-chain {
            font-size: 0.9rem; /* Ligeramente más grande */
            opacity: 0.2; 
            transition: opacity 0.3s;
            overflow: hidden; 
            text-overflow: ellipsis; 
            white-space: nowrap; 
        }
        .subtle-protocol-chain:hover {
            opacity: 1; 
            overflow: visible;
            white-space: normal;
        }

        /* Shine Animation */
        @keyframes shine {
            0%, 100% { 
                text-shadow: 0 0 15px #ffff00, 0 0 30px #fff, 0 0 50px #ffff00, 0 0 70px #ffff00;
                filter: brightness(1) drop-shadow(0 0 10px rgba(255,255,0,0.5)); 
                opacity: 1; 
            }
            50% { 
                text-shadow: 0 0 20px #ffff00, 0 0 40px #fff, 0 0 60px #ffff00, 0 0 90px #ffff00;
                filter: brightness(1.2) drop-shadow(0 0 15px rgba(255,255,0,0.8)); 
                opacity: 0.98;
            }
        }

        /* New Shining Link/Key Effect (for Phase 6 cipher code) */
        .shining-link {
            text-decoration: none;
            color: #ffff00 !important; 
            font-weight: bold;
            border-bottom: 1px solid #ffff00;
            padding-bottom: 2px;
            animation: shine 1.2s ease-in-out infinite; 
            text-shadow: 0 0 15px #ffff00, 0 0 30px #fff;
        }
        
        .shining-link a {
            pointer-events: auto !important; 
            cursor: pointer;
        }

        /* NEW: Shining image for Phase 6 */
        .shining-image {
            animation: shine 1.2s ease-in-out infinite;
            filter: brightness(1) drop-shadow(0 0 10px rgba(255,255,0,0.5));
            max-width: 100%; 
            height: auto;
            display: block; 
            margin: 0 auto; 
        }

        /* New Clue Style (without aggressive shine) */
        .secondary-clue {
            opacity: 0;
            transition: opacity 0.5s ease-in;
            font-style: italic;
            color: #ffff00; 
            font-weight: bold;
        }
        .secondary-clue.visible {
            opacity: 1;
            text-shadow: 0 0 2px #ffff00; 
        }
    </style>
</head>
<body class="flex items-center justify-center p-4 font-mono">

    <audio id="backgroundAudio" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" preload="auto" loop></audio>
    <audio id="successSFX" src="https://actions.google.com/sounds/v1/alarms/digital_alarm_buzz.ogg" preload="auto"></audio>
    <audio id="errorSFX" src="https://actions.google.com/sounds/v1/cartoon/whistle_fail.ogg" preload="auto"></audio>
    
    <div id="welcomeContainer" class="w-full max-w-xl animate-fade-in">
        <div class="terminal-window p-6 sm:p-8 rounded-none text-center">
            <h1 class="text-3xl sm:text-5xl font-extrabold text-neon-yellow mb-4 glitch-title">
                > GOOD TO SEE YOU AGAIN. <
            </h1>
            <h2 class="text-xl font-bold text-neon-blue mb-4">
                [ ACCESS GRANTED: AGENT REACQUISITION ]
            </h2>
            <p class="text-xl sm:text-lg text-neon-green mb-6 border-b border-neon-green/50 pb-4">
                [ PROTOCOL_RESUMED_7.EXE ]
            </p>
            <p class="text-lg sm:text-base text-neon-green mb-8">
                **This is the ultimate test.** We are **recruiting the next generation of elite**. Decrypt this security chain to verify your aptitude. The protocol is active; use your intelligence and resources to find the solution. **Prove you are the one percent.**
            </p>
            
            <button
                id="startMissionButton"
                class="submit-btn py-4 px-8 rounded-none text-xl transition duration-300"
            >
                [ RE-ENGAGE MISSION ]
            </button>
        </div>
    </div>
    
    <div id="mainContainer" class="w-full max-w-xl hidden opacity-0">
        <div class="terminal-window p-6 sm:p-8 rounded-none">
            
            <div class="mb-4 text-base sm:text-sm text-neon-blue border-b border-neon-blue/20 pb-2 subtle-protocol-chain">
                // ACTIVE_CHAIN_HASH: <span class="text-neon-yellow">Riddle</span> <span class="text-neon-yellow">RailFence</span> <span class="text-neon-yellow">ASCII</span> <span class="text-neon-yellow">A1Z26</span> <span class="text-neon-yellow">Book</span> <span class="text-neon-yellow">Pigpen</span>.
            </div>

            <div class="flex justify-between items-center mb-6 border-b border-neon-green pb-2">
                <span id="statusHeader" class="text-xl sm:text-lg text-neon-blue font-bold uppercase">
                    [SYSTEM_LOG]
                </span>
                <span id="protocolStatus" class="text-xl sm:text-lg text-neon-green">
                    > STATUS: PENDING_AUTH <span class="cursor quick-blink">_</span>
                </span>
            </div>

            <div id="phase1Section">
                <h2 class="text-2xl sm:text-xl font-bold text-neon-green mb-4 text-center">
                    [PHASE 1: THE FIRST LIGHT]
                </h2>
                <p class="mb-6 text-xl sm:text-base text-neon-green">
                    <span class="text-neon-blue">_MESSAGE_START:</span><br>
                    "The project requires maximum adaptability. Embrace lateral vision, cultural knowledge, and your intuition. This first protocol breaks computational logic. Trust yourself."
                </p>
                <div class="mb-6 pt-4 border-t border-neon-green/50">
                    <p class="text-xl sm:text-lg text-neon-green">
                        [QUERY_01]: "I am a body in the sky that shrinks and grows. I give you light at night, though my shine is borrowed. What am I?"
                    </p>
                    <p class="text-lg sm:text-base text-neon-yellow mt-2 font-bold">
                        >> GOOD LUCK, AGENT. The first sequence awaits your intellect.
                    </p>
                </div>
                <div class="flex flex-col sm:flex-row gap-3">
                    <input
                        type="text"
                        id="answerInput1"
                        placeholder="> ENTER CELESTIAL CODE..."
                        class="flex-grow p-3 rounded-none bg-terminal-black focus:ring-0 border-neon-green uppercase text-xl sm:text-lg"
                    >
                    <button
                        id="submitButton1"
                        class="submit-btn py-3 px-6 rounded-none text-xl sm:text-lg transition duration-300"
                    >
                        [ EXECUTE ]
                    </button>
                </div>
            </div>

            <div id="phase2Section" class="mt-8 pt-6 border-t border-neon-blue disabled-phase hidden opacity-0 transition duration-1000">
                <h2 class="text-2xl sm:text-xl font-bold text-neon-blue mb-4 text-center">
                    [PHASE 2: REARRANGING DATA]
                </h2>
                <p class="text-xl sm:text-base text-neon-yellow mb-4 text-center font-bold">
                    [CLUE]: "I do not substitute; I merely rearrange. To read me, you must zig-zag across two silent tracks."
                </p>
                
                <p class="text-lg sm:text-base text-neon-green mb-2 font-bold text-center">
                    >> EXCELLENT WORK. Focus on the structure of the paths.
                </p>
                <div class="text-center mb-6">
                    <p id="cipherCode2" class="text-3xl sm:text-3xl font-mono tracking-widest text-neon-blue p-3 bg-gray-900/50 rounded-none inline-block shadow-inner shadow-neon-green/30 whitespace-nowrap border-r-4 border-l-4 border-neon-blue">
                        C Y B R E
                    </p>
                </div>
                <div class="flex flex-col sm:flex-row gap-3">
                    <input
                        type="text"
                        id="answerInput2"
                        placeholder="> ENTER DECRYPTED WORD..."
                        class="flex-grow p-3 rounded-none bg-terminal-black focus:ring-0 border-neon-blue uppercase text-xl sm:text-lg"
                    >
                    <button
                        id="submitButton2"
                        class="submit-btn py-3 px-6 rounded-none text-xl sm:text-lg transition duration-300"
                    >
                        [ DECODE ]
                    </button>
                </div>
            </div>

            <div id="phase3Section" class="mt-8 pt-6 border-t border-neon-yellow disabled-phase hidden opacity-0 transition duration-1000">
                <h2 class="text-2xl sm:text-xl font-bold text-neon-yellow mb-4 text-center">
                    [PHASE 3: THE CRITICAL PATH]
                </h2>
                <p class="text-xl sm:text-base text-neon-green mb-4 text-center font-bold">
                    [CLUE]: "You're close. The path is numbered in the standard system. Decode the stream of integers into their sequence."
                </p>
                
                <p id="secondaryClue3" class="text-lg sm:text-base text-neon-yellow mt-0 mb-4 font-bold text-center secondary-clue">
                    **Do you know the ASCII code? It could help you!**
                </p>

                <p class="text-lg sm:text-base text-neon-purple mb-2 font-bold text-center">
                    >> WARNING: EXACT INPUT REQUIRED. The sequence holds a direct address.
                </p>
                
                <div class="text-center mb-6">
                    <p id="cipherCode3" class="text-xl sm:text-xl font-mono tracking-widest text-neon-yellow p-3 bg-gray-900/50 rounded-none inline-block shadow-inner shadow-neon-purple/30 whitespace-normal border-r-4 border-l-4 border-neon-yellow">
                        104 116 116 112 115 58 47 47 110 57 46 99 108 47 99 50 106 115 117
                    </p>
                    <p id="decryptedLinkDisplay" class="text-lg sm:text-base text-neon-yellow font-bold mt-4 hidden opacity-0 transition duration-500 ease-in-out">
                        Click here: <a id="activeLink" href="#" target="_blank" class="text-neon-purple">N/A</a> 
                    </p>
                    <p class="text-base sm:text-sm text-neon-green mt-2">
                        (Enter the decrypted path exactly as read, no spaces or uppercase.)
                    </p>
                </div>

                <div class="flex flex-col sm:flex-row gap-3">
                    <input
                        type="text"
                        id="answerInput3"
                        placeholder="> ENTER DECRYPTED PATH..."
                        class="flex-grow p-3 rounded-none bg-terminal-black focus:ring-0 border-neon-yellow lowercase text-xl sm:text-lg"
                    >
                    <button
                        id="submitButton3"
                        class="submit-btn py-3 px-6 rounded-none text-xl sm:text-lg transition duration-300"
                    >
                        [ RESOLVE PATH ]
                    </button>
                </div>
            </div>
            
            <div id="phase4Section" class="mt-8 pt-6 border-t border-neon-green disabled-phase hidden opacity-0 transition duration-1000">
                <h2 class="text-2xl sm:text-xl font-bold text-neon-green mb-4 text-center">
                    [PHASE 4: THE SIMPLE TRUTH]
                </h2>
                <p class="text-xl sm:text-base text-neon-yellow mb-4 text-center font-bold">
                    [CLUE]: "I am the language of position. To read me, you must speak the sequence of the first 26."
                </p>
                
                <p class="text-lg sm:text-base text-neon-blue mb-2 font-bold text-center">
                    >> REMINDER: You have solved this type of challenge before. Recall your basic cipher knowledge.
                </p>

                <p class="text-lg sm:text-base text-neon-yellow mb-2 font-bold text-center">
                    >> THIS IS A DIRECT CALCULATION.
                </p>
                
                <div class="text-center mb-6">
                    <p id="cipherCode4" class="text-3xl sm:text-3xl font-mono tracking-widest text-neon-green p-3 bg-gray-900/50 rounded-none inline-block shadow-inner shadow-neon-blue/30 whitespace-nowrap border-r-4 border-l-4 border-neon-green">
                        05 12 09 20 05
                    </p>
                </div>

                <div class="flex flex-col sm:flex-row gap-3">
                    <input
                        type="text"
                        id="answerInput4"
                        placeholder="> ENTER ALPHABETIC KEY (NO SPACES)..."
                        class="flex-grow p-3 rounded-none bg-terminal-black focus:ring-0 border-neon-green uppercase text-xl sm:text-lg"
                    >
                    <button
                        id="submitButton4"
                        class="submit-btn py-3 px-6 rounded-none text-xl sm:text-lg transition duration-300"
                    >
                        [ DECODE ALFA ]
                    </button>
                </div>
            </div>
            <div id="phase5Section" class="mt-8 pt-6 border-t border-neon-purple disabled-phase hidden opacity-0 transition duration-1000">
                <h2 class="text-2xl sm:text-xl font-bold text-neon-purple mb-4 text-center">
                    [PHASE 5: CONTEXTUAL INDEXING]
                </h2>
                <p class="text-xl sm:text-base text-neon-yellow mb-4 text-center font-bold">
                    [CLUE]: "I speak not with letters, but with indices. My message is hidden within the pages we both share."
                </p>
                <p class="text-lg sm:text-base text-neon-blue mb-2 font-bold text-center">
                    >> THIS PHASE REQUIRES CONTEXT.
                </p>
                
                <p id="secondaryClue5" class="text-lg sm:text-base text-neon-yellow mt-2 mb-4 font-bold text-center secondary-clue">
                    The key is the word, the lock is the index.
                </p>
                
                <div class="bg-gray-900/50 p-4 mb-6 border border-neon-purple/50 text-lg sm:text-base leading-5">
                    <span class="text-neon-purple font-bold">SOURCE_TEXT (CYBER_MANIFESTO_1.0):</span><br>
                    <p id="sourceText" class="whitespace-normal">
                        There are systems everywhere. To really win, the agent must understand that the best defense is often the ability to hide in plain sight. Our future is in the network, not in the shadows. Replicate your presence.
                    </p>
                </div>

                <div class="text-center mb-6">
                    <p id="cipherCode5" class="text-3xl sm:text-3xl font-mono tracking-widest text-neon-purple p-3 bg-gray-900/50 rounded-none inline-block shadow-inner shadow-neon-blue/30 whitespace-nowrap border-r-4 border-l-4 border-neon-purple">
                        10 16 3 34 27 25 30
                    </p>
                </div>

                <div class="flex flex-col sm:flex-row gap-3">
                    <input
                        type="text"
                        id="answerInput5"
                        placeholder="> ENTER DECRYPTED PASSWORD (NO SPACES)..."
                        class="flex-grow p-3 rounded-none bg-terminal-black focus:ring-0 border-neon-purple uppercase text-xl sm:text-lg"
                    >
                    <button
                        id="submitButton5"
                        class="submit-btn py-3 px-6 rounded-none text-xl sm:text-lg transition duration-300"
                    >
                        [ VERIFY ]
                    </button>
                </div>
            </div>
            <div id="phase6Section" class="mt-8 pt-6 border-t border-neon-yellow disabled-phase hidden opacity-0 transition duration-1000">
                <h2 class="text-2xl sm:text-xl font-bold text-neon-yellow mb-4 text-center">
                    [PHASE 6: THE FINAL ENCRYPTION]
                </h2>
                <p class="text-xl sm:text-base text-neon-green mb-4 text-center font-bold">
                    >> FINAL KEY REQUIRED. Confirm your loyalty with the ancient protocol.
                </p>
                <p class="text-lg sm:text-base text-neon-blue mb-2 font-bold text-center">
                    >> THIS IS IT. Trust the symbols of the brotherhood.
                </p>
                
                <p id="secondaryClue6" class="text-lg sm:text-base text-neon-yellow mt-2 mb-4 font-bold text-center secondary-clue">
                    "Sometimes, returning to your past is the solution."
                </p>

                <div class="bg-gray-900/50 p-4 mb-6 border border-neon-yellow/50 text-lg sm:text-base leading-5">
                    <span class="text-neon-yellow font-bold">FINAL KEY REFERENCE:</span><br>
                    <p class="text-neon-blue leading-tight mb-2">
                        [RIDDLE]: "I am drawn from nine cells and two 'X' marks. My letters are pieces of a grid, some holding a single point of light. The secret is held by geometry."
                    </p>
                </div>

                <div class="text-center mb-6">
                    <img id="cipherImage6" src="/AGENT.png" alt="Pigpen Cipher" class="shining-image w-2/3 md:w-1/2 lg:w-1/3 mx-auto p-3 bg-gray-900/50 rounded-none shadow-inner shadow-neon-purple/30 border-r-4 border-l-4 border-neon-yellow" style="image-rendering: pixelated;"/>
                </div>

                <div class="flex flex-col sm:flex-row gap-3">
                    <input
                        type="text"
                        id="answerInput6"
                        placeholder="> ENTER FINAL DECRYPTED KEY..."
                        class="flex-grow p-3 rounded-none bg-terminal-black focus:ring-0 border-neon-yellow uppercase text-xl sm:text-lg"
                    >
                    <button
                        id="submitButton6"
                        class="submit-btn py-3 px-6 rounded-none text-xl sm:text-lg transition duration-300"
                    >
                        [ FINAL DECRYPT ]
                    </button>
                </div>
            </div>

            <div id="resultOutput" class="mt-8 p-5 text-center hidden">
            </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- AUDIO CONSTANTS AND REFERENCES ---
            const backgroundAudio = document.getElementById('backgroundAudio');
            const successSFX = document.getElementById('successSFX');
            const errorSFX = document.getElementById('errorSFX');
            
            const startBackgroundMusic = () => {
                if (backgroundAudio && backgroundAudio.src.includes('soundhelix')) { 
                    backgroundAudio.volume = 0.5; 
                    backgroundAudio.play().catch(e => console.log("Background audio playback failed:", e));
                } else {
                    console.log("Audio placeholder not replaced or playback failed.");
                }
            };
            // --- END AUDIO SETUP ---

            // Element References
            const welcomeContainer = document.getElementById('welcomeContainer');
            const startMissionButton = document.getElementById('startMissionButton');
            const mainContainer = document.getElementById('mainContainer');
            const statusHeader = document.getElementById('statusHeader');
            const protocolStatus = document.getElementById('protocolStatus');
            const resultOutput = document.getElementById('resultOutput');

            // Phases Elements
            const phase1Section = document.getElementById('phase1Section');
            const phase2Section = document.getElementById('phase2Section');
            const phase3Section = document.getElementById('phase3Section');
            const phase4Section = document.getElementById('phase4Section'); 
            const phase5Section = document.getElementById('phase5Section'); 
            const phase6Section = document.getElementById('phase6Section'); 

            // Specific Elements
            const pathSolution = 'https://n9.cl/c2jsu'; 
            const activeLink = document.getElementById('activeLink');
            const decryptedLinkDisplay = document.getElementById('decryptedLinkDisplay');
            const secondaryClue3 = document.getElementById('secondaryClue3'); 
            const secondaryClue5 = document.getElementById('secondaryClue5'); 
            const secondaryClue6 = document.getElementById('secondaryClue6'); 
            const cipherImage6 = document.getElementById('cipherImage6'); 


            // Utility functions (showMessage, activateNextPhase, etc.)
            const showMessage = (message, isSuccess = false, borderColorClass = 'border-red-600') => {
                
                if (isSuccess) {
                    successSFX.currentTime = 0;
                    successSFX.play().catch(e => console.log("Success SFX failed:", e));
                } else {
                    errorSFX.currentTime = 0;
                    errorSFX.play().catch(e => console.log("Error SFX failed:", e));
                }
                
                resultOutput.classList.remove('hidden', 'border-red-600', 'border-neon-green', 'border-neon-blue', 'border-neon-purple', 'border-neon-yellow', 'border-4');
                resultOutput.classList.add('bg-terminal-black', 'border', 'rounded-none', 'animate-fade-in');
                
                if (isSuccess) {
                    resultOutput.classList.add(`border-${borderColorClass}`);
                    resultOutput.innerHTML = `<p class="text-xl sm:text-base text-neon-green">[STATUS: OK] ${message}</p>`; /* Ajuste de tamaño */
                } else {
                    resultOutput.classList.add('border-glitch-red');
                    resultOutput.innerHTML = `<p class="text-xl sm:text-base text-glitch-red">[ERROR] ${message}</p>`; /* Ajuste de tamaño */
                }
                
                if (!isSuccess) {
                    setTimeout(() => {
                        resultOutput.classList.add('hidden');
                        resultOutput.classList.remove('bg-terminal-black', 'border-glitch-red', 'border');
                        resultOutput.innerHTML = '';
                    }, 3000);
                }
            };

            const activateNextPhase = (currentPhase, nextPhase, phaseNumber, color) => {
                currentPhase.classList.add('disabled-phase');
                if (nextPhase) {
                    nextPhase.classList.remove('hidden');
                    nextPhase.classList.remove('disabled-phase');
                    
                    setTimeout(() => {
                        nextPhase.classList.add('opacity-100');
                        nextPhase.classList.remove('opacity-0');
                        statusHeader.innerHTML = `<span class="text-xl sm:text-lg">[PHASE ${phaseNumber}]</span>`; /* Ajuste de tamaño */
                        protocolStatus.innerHTML = `<span class="text-xl sm:text-lg">> STATUS: ACTIVE <span class="cursor quick-blink">_</span></span>`; /* Ajuste de tamaño */
                        
                        const clueDelay = 15000; 
                        
                        if (phaseNumber === '3') {
                            secondaryClue3.classList.remove('visible'); 
                            setTimeout(() => { secondaryClue3.classList.add('visible'); }, clueDelay); 
                        } else if (phaseNumber === '5') {
                            secondaryClue5.classList.remove('visible'); 
                            setTimeout(() => { secondaryClue5.classList.add('visible'); }, clueDelay); 
                        } else if (phaseNumber === '6') {
                            if (cipherImage6) { cipherImage6.classList.add('shining-image'); }
                            secondaryClue6.classList.remove('visible'); 
                            setTimeout(() => { secondaryClue6.classList.add('visible'); }, clueDelay); 
                        }

                    }, 50);
                }
                
                showMessage("PROTOCOL ACCEPTED. ADVANCING TO NEXT ENCRYPTION LAYER. Keep up the good work.", true, color);
            };
            
            const showFinalSuccess = (targetPhrase) => {
                phase6Section.classList.add('opacity-50');

                successSFX.currentTime = 0;
                successSFX.play().catch(e => console.log("Final Success SFX failed:", e));

                resultOutput.classList.remove('hidden', 'border-red-600', 'border-neon-yellow');
                resultOutput.classList.add('bg-terminal-black', 'border-4', 'border-neon-purple', 'rounded-none', 'animate-fade-in');

                // CORRECCIÓN PARA MÓVIL: CLASES RESPONSIVAS Y SÍMBOLO CAMBIADO
                resultOutput.innerHTML = `
                    <p class="text-2xl sm:text-xl font-bold text-neon-green mb-4">
                        [ FULL PROTOCOL DECRYPTED ]
                    </p>
                    <p class="text-4xl sm:text-3xl font-extrabold text-neon-yellow tracking-wider mb-6">
                        ${targetPhrase}
                    </p>
                    <p class="text-2xl sm:text-xl text-neon-green font-bold mb-4">
                        AGENT AUTHORIZED. YOUR PROFILE HAS BEEN ACCEPTED INTO THE CIRCLE.
                    </p>
                    <p class="text-5xl sm:text-4xl font-extrabold text-neon-green tracking-widest">
                        MISSION ACCOMPLISHED <span class="text-6xl sm:text-5xl">✓</span>
                    </p>
                `;
            }

            // --- EVENT LISTENERS ---
            startMissionButton.addEventListener('click', () => {
                startBackgroundMusic(); // Start BGM on user interaction
                welcomeContainer.classList.add('hidden');
                mainContainer.classList.remove('hidden');
                setTimeout(() => {
                    mainContainer.classList.add('opacity-100');
                    mainContainer.classList.remove('opacity-0');
                    statusHeader.innerHTML = `<span class="text-xl sm:text-lg">[PHASE 1]</span>`; /* Ajuste de tamaño */
                    protocolStatus.innerHTML = `<span class="text-xl sm:text-lg">> STATUS: ACTIVE <span class="cursor quick-blink">_</span></span>`; /* Ajuste de tamaño */
                }, 50);
            });


            // Helper function to handle the core logic for all phases
            const setupPhaseLogic = (phaseNum, correctAns, color, nextPhaseSection, inputId, buttonId, cleanFn, customSuccessFn) => {
                const inputElement = document.getElementById(inputId);
                const buttonElement = document.getElementById(buttonId);
                const currentSection = document.getElementById(`phase${phaseNum}Section`);
                const nextSection = (nextPhaseSection) ? document.getElementById(nextPhaseSection) : null;

                const checkAnswer = () => {
                    const decodedMessage = cleanFn(inputElement.value);

                    if (decodedMessage === correctAns) {
                        inputElement.disabled = true;
                        buttonElement.disabled = true;
                        buttonElement.classList.replace('submit-btn', 'bg-gray-700');
                        
                        if (phaseNum === 3) {
                            activeLink.textContent = pathSolution;
                            activeLink.href = pathSolution;
                            buttonElement.innerText = "[ PATH RESOLVED ]";
                        } else if (phaseNum === 6) {
                            buttonElement.innerText = "[ PROTOCOL COMPLETE ]";
                            showFinalSuccess(correctAns);
                            return; 
                        } else {
                            buttonElement.innerText = (phaseNum === 1) ? "[ SOURCE LOCKED ]" : 
                                                     (phaseNum === 2) ? "[ DECODE LOCKED ]" : 
                                                     (phaseNum === 4) ? "[ ALFA LOCKED ]" : 
                                                     "[ VERIFIED ]";
                        }
                        
                        if (phaseNum === 5) {
                            showMessage("PROTOCOL ACCEPTED. ADVANCING TO NEXT ENCRYPTION LAYER. Keep up the good work.", true, color);
                            resultOutput.classList.remove('hidden', 'border-red-600', 'border-neon-yellow');
                            resultOutput.classList.add('bg-terminal-black', 'border', 'border-neon-purple', 'rounded-none', 'animate-fade-in');

                            if (activeLink.href === pathSolution) { 
                                activeLink.classList.remove('text-neon-purple'); 
                                decryptedLinkDisplay.classList.add('shining-link'); 
                                decryptedLinkDisplay.classList.remove('hidden', 'opacity-0');
                                decryptedLinkDisplay.classList.add('opacity-100');
                            }

                            resultOutput.innerHTML = `
                                <p class="text-xl sm:text-base text-neon-green">[CONTEXTUAL INDEXING VERIFIED]</p>
                                <p class="text-xl sm:text-base text-neon-yellow mb-2">
                                    **SUCCESS.** The indices are aligned. Proceed to the final vector.
                                </p>
                            `;
                            activateNextPhase(currentSection, nextSection, '6', color);
                            return;
                        }

                        activateNextPhase(currentSection, nextSection, phaseNum + 1, color);

                    } else {
                        const errorMsg = (phaseNum === 1) ? "ACCESS DENIED. INCORRECT CODE SOURCE." : 
                                         (phaseNum === 6) ? "FINAL ACCESS DENIED. KEY MISMATCH. This is the final step, give it everything you've got." :
                                         "DECRYPTION FAILED. SEQUENCE MISMATCH. Check the details and try again.";
                        showMessage(errorMsg, false, color);
                    }
                };

                buttonElement.addEventListener('click', checkAnswer);
                inputElement.addEventListener('keypress', (e) => { 
                    if (e.key === 'Enter' && !buttonElement.disabled) checkAnswer(); 
                });
            };

            // Setup for all phases (using the refactored function)
            setupPhaseLogic(1, 'moon', 'neon-green', 'phase2Section', 'answerInput1', 'submitButton1', (val) => val.trim().toLowerCase().replace(/[^a-z]/g, ''));
            setupPhaseLogic(2, 'CYBER', 'neon-blue', 'phase3Section', 'answerInput2', 'submitButton2', (val) => val.trim().toUpperCase().replace(/[^A-Z]/g, ''));
            setupPhaseLogic(3, pathSolution, 'neon-yellow', 'phase4Section', 'answerInput3', 'submitButton3', (val) => val.trim().toLowerCase());
            setupPhaseLogic(4, 'ELITE', 'neon-green', 'phase5Section', 'answerInput4', 'submitButton4', (val) => val.trim().toUpperCase().replace(/[^A-Z]/g, ''));
            setupPhaseLogic(5, 'MISSION', 'neon-purple', 'phase6Section', 'answerInput5', 'submitButton5', (val) => val.trim().toUpperCase().replace(/[^A-Z]/g, ''));
            setupPhaseLogic(6, 'AGENT', 'neon-yellow', null, 'answerInput6', 'submitButton6', (val) => val.trim().toUpperCase().replace(/[^A-Z]/g, ''));

        });
    </script>
</body>
</html>